---
title: "Homework 3"
author: "mm5951"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggridges)
library(patchwork)
```

## Problem 1

Solution provided by teaching team.

## Problem 2
Let's investigate the accelerometer dataset for the diagnosis of congestive heart failure (CHF). 

### Data import
I first **load, tidy, and wrangle data** using the `read_csv` and `janitor::clean_names` functions. A variable to distinguish between weekdays and weekends is created using `mutate` function and place it next to the "day" column using `relocate`. 

Next, I address the "activity_*" variables, which correspond to the activity counts for each minute of a 24-hour day starting at midnight. The dataframe is transposedusing the `pivot_longer` function, by which all activity observations are classified under "minute" according to the minute (1, 1440) of each of the five days to which they correspond, and its associated value falls under "activity_counts".

Finally, the 6 resulting variables are coerced into number and factor types as adequate using the `as.numeric` and `factor` functions. 

```{r}
accel_df = read_csv("data_problem2/accel_data.csv") %>%
  janitor::clean_names() %>% 
  mutate(
    weekend_or_weekday = if_else((day == "Saturday" | day == "Sunday"),"Weekend","Weekday")) %>% 
  relocate(week,day_id, day,weekend_or_weekday) %>% 
  pivot_longer(
    cols = activity_1:activity_1440,
    names_to = "minute",
    values_to = "activity_counts",
    names_prefix = "activity_"
   ) %>% 
  mutate(
  minute = as.numeric(minute),
  day = factor(day, level = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
  weekend_or_weekday = factor(weekend_or_weekday, level = c("Weekday", "Weekend"))
  )
```

The `str` function reveals the nature of data of each of the variables (that is a verification).

```{r}
str(accel_df)
```

### Dataset description
The accel_df dataset contains five weeks of accelerometer data collected on a 63 year-old male with BMI 25, who was admitted to the Advanced Cardiac Care Center of Columbia University Medical Center and diagnosed with congestive heart failure (CHF). 

The "accel_df" dataset contains `r nrow(accel_df)` observations of activity (accelerometer data), and there are `r ncol(accel_df)` variables, which are `r names(accel_df)` that describing the information of data. Specifically, `r names(accel_df)[5]` stands for the number of minute of a 24-hour day starting at midnight, range from `r range(pull(accel_df, minute))` minutes. And `r names(accel_df)[6]` stands for the activity count of the male collected by accelerometer, ranging from `r range(pull(accel_df, activity_counts))`.


### Daily activity [NEXT]
Traditional analyses of accelerometer data focus on the total activity over the day. Using your tidied dataset, aggregate across minutes to create a total activity variable for each day, and create a table showing these totals. Are any trends apparent?

```{r}
total_activity_df = accel_df %>% 
  group_by(day_id) %>% 
  summarize(total_activity = sum(activity_counts)) 
knitr::kable(total_activity_df)
```

Investigate trends:

```{r}
ggplot(total_activity_df,aes(x = day_id, y = total_activity)) +
  geom_point() +
  geom_line() +
  labs(
    title = "Trend for total activity counts for each day in five weeks",
    x = "Day ID",
    y = "Total Activity counts",
    caption = "Data from accel_data.csv"
  ) +
  scale_x_continuous(breaks = seq(0,35,by = 5)) +
  theme(plot.title = element_text(hjust = 0.5))
```

The trend of total activity counts for each day is dramatically changed over time in five weeks.

### Data visualization [NEXT]
Accelerometer data allows the inspection activity over the course of the day. Make a single-panel plot that shows the 24-hour activity time courses for each day and use color to indicate day of the week. Describe in words any patterns or conclusions you can make based on this graph.

```{r fig.width = 10, fig.height = 9}
accel_df %>% 
  ggplot(aes(x = minute, y = activity_counts, color = day)) +
  geom_point() +
  geom_line(alpha = .3) +
  scale_x_continuous(breaks = seq(0,1440,by = 60),
                     label = seq(0,24,by = 1),
                     limits = c(0,1440)) +
  labs(
    title = "24-hour activity time courses for each day of the week",
    x = "Hours",
    y = "Activity counts",
    caption = "Data from accel_data.csv"
  ) +
  theme(plot.title = element_text(hjust = 0.5))
```

This 63 year-old male typically start activity at around 7 AM. The activity counts between 11 AM to 12 AM and 16 PM to 17 PM increased during weekend (Saturday and Sunday). There is a large increase in activity counts between 20 PM to 22 PM for most of the days in week (especially on Friday). And this male tend to sleep at around 22 PM.

